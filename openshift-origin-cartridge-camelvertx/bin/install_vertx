#!/bin/bash -eu

version=6.0

echo "$version" > "$OPENSHIFT_CAMELVERTX_DIR/env/OPENSHIFT_CAMELVERTX_VERSION"

cp -r ${OPENSHIFT_CAMELVERTX_DIR}/versions/${version}/template/vertx/* ${OPENSHIFT_CAMELVERTX_DIR}/template

if [ -z "${OPENSHIFT_CAMELVERTX_CLUSTER}" ]; then
	OPENSHIFT_CAMELVERTX_CLUSTER="${OPENSHIFT_CAMELVERTX_IP}"
fi

pushd $OPENSHIFT_CAMELVERTX_DIR/template/vertx
  sed -i -e "s/\${env.OPENSHIFT_CAMELVERTX_IP}/${OPENSHIFT_CAMELVERTX_IP}/g" \
  		-e "s/\${env.OPENSHIFT_CAMELVERTX_CLUSTER}/${OPENSHIFT_CAMELVERTX_CLUSTER}/g" \
  		./vert.x-1.3.1.final/conf/cluster.xml
  sed -i -e "s/\${env.OPENSHIFT_CAMELVERTX_IP}/${OPENSHIFT_CAMELVERTX_IP}/g" ./bin/run-vertx.sh
popd