#!/bin/bash -eu

version=6.0

echo "$version" > "$OPENSHIFT_CAMELVERTX_DIR/env/OPENSHIFT_CAMELVERTX_VERSION"

cp -r ${OPENSHIFT_CAMELVERTX_DIR}/versions/${version}/template/vertx/* ${OPENSHIFT_CAMELVERTX_DIR}/template

OPENSHIFT_CAMELVERTX_CLUSTER="${OPENSHIFT_CAMELVERTX_IP}"

OPENSHIFT_CAMELVERTX_PROXY_IP=$(nslookup ${OPENSHIFT_GEAR_DNS} | awk '/^Address: / { print $2 ; exit }')

pushd $OPENSHIFT_CAMELVERTX_DIR/template
	sed -i -e "s/\${env.OPENSHIFT_CAMELVERTX_IP}/${OPENSHIFT_CAMELVERTX_IP}/g" ./bin/run-vertx.sh
	sed -i -e "s/\${env.OPENSHIFT_CAMELVERTX_IP}/${OPENSHIFT_CAMELVERTX_IP}/g" \
		-e "s/\${env.OPENSHIFT_CAMELVERTX_PROXY_IP}/${OPENSHIFT_CAMELVERTX_PROXY_IP}/g" \
		-e "s/\${env.OPENSHIFT_CAMELVERTX_CLUSTER_PROXY_PORT}/${OPENSHIFT_CAMELVERTX_CLUSTER_PROXY_PORT}/g" \
		./vert.x-1.3.1.final/bin/vertx
	sed -i -e "s/\${env.OPENSHIFT_CAMELVERTX_IP}/${OPENSHIFT_CAMELVERTX_IP}/g" ./web.js
popd
